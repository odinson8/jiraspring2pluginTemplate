<!-- 
Written by Veniture
Berk Karabacak
-->

$webResourceManager.requireResource("com.veniture.PortfolioManagement:PortfolioManagement-resources")

<html>

<head>
    <title>Proje Onay</title>

    <link href="https://nightly.datatables.net/css/jquery.dataTables.css" rel="stylesheet" type="text/css" />
    <script src="https://nightly.datatables.net/js/jquery.dataTables.js"></script>
    <link href="https://nightly.datatables.net/select/css/select.dataTables.css?_=9a6592f8d74f8f520ff7b22342fa1183.css" rel="stylesheet" type="text/css" />
    <script src="https://nightly.datatables.net/select/js/dataTables.select.js?_=9a6592f8d74f8f520ff7b22342fa1183"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/js/select2.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.datatables.net/fixedcolumns/3.3.0/js/dataTables.fixedColumns.min.js"></script>
    <link href="https://cdn.datatables.net/fixedcolumns/3.3.0/css/fixedColumns.dataTables.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes"></script>


    <style id="css">
        /*td {*/
        /*}*/

        .aui-group {
             margin: 1px !important;
        }

        a { cursor: pointer; }
        span { cursor: pointer !important; }


         table > tbody > tr > td {
            text-overflow: ellipsis !important;
            overflow : hidden !important;
            white-space: nowrap !important;
            max-width: 400px !important;
            min-width: 20px !important;
            vertical-align: middle;
            horizontal-align: left;
            word-break: break-all !important;
        }
         table > tbody > tr > td:hover {
            text-overflow: clip !important;
            white-space: normal !important;
            word-break: break-all !important;
            max-width: 400px !important;
            min-width: 20px !important;
        }

        table.dataTable th {
            white-space: nowrap;
            max-width: 400px !important;
            min-width: 20px !important;
            text-overflow: clip !important;
        }

        /*.might-overflow {*/
        /*    text-overflow: ellipsis !important;*/
        /*    overflow : hidden !important;*/
        /*    white-space: nowrap !important;*/
        /*    max-width: 400px !important;*/
        /*    min-width: 20px !important;*/
        /*}*/
        
        /*.might-overflow:hover {*/
        /*    text-overflow: clip !important;*/
        /*    white-space: normal !important;*/
        /*    word-break: break-all !important;*/
        /*    max-width: 400px !important;*/
        /*    min-width: 20px !important;*/
        /*}*/

    </style>

    <script>
        AJS.$(document).ready(function() {
            
            Swal.showLoading();

            var table;
            table=AJS.$("#projectsTable").DataTable( {
                "scrollX"   : false,
                "scrollY":        "600px",
                "scrollCollapse": true,
                "paging":         false,
                "order": [[ 2, "asc" ]],
                // dom: 'Bfrtip',
                // buttons: [
                //     'copy', 'csv', 'excel', 'pdf', 'print'
                // ],
                // "pageLength": 15,
                "select"    :  {
                    style:    'select',
                    // STATIC VARIABLE !!!!
                    selector: 'td:nth-child(1)'
                },
                fixedColumns: {
                    leftColumns: 1
                },
                columnDefs: [{
                    orderable: false,
                    className: 'select-checkbox',
                    // STATIC VARIABLE !!!!
                    targets:   1
                },
                    {"width": "6px", 'targets': 1},
                    { targets: [1, 2, 3, 9], visible: true},
                    { targets: '_all', visible: false }
                ],
                footerCallback: function (row, data, start, end, display) {
                    displayFooter();
                }
            });

            function displayFooter() {
                //table = AJS.$('#projectsTable').DataTable();
                table = AJS.$('#projectsTable').DataTable();

                // Total over all pages
                var intVal = function (i) {
                    return typeof i === 'undefined' ? 0 : i * 1;
                };

                /*      var totalize_filtered = function (col) {
                          var data = table.column(col, {
                              search: 'applied'
                          }).data();
                          if (typeof data != 'undefined') {
                              return data
                                      .reduce(function (a, b) {
                                                  return intVal(a) + intVal(b);
                                              },
                                              0);
                          } else {
                              return 0;
                          }
                      };*/

                var totalize_selected = function (col) {
                    var data = table.cells('.selected', col).data();
                    if (typeof data != 'undefined') {
                        return data
                            .reduce(function (a, b) {
                                    if (b === "-") {
                                        b = "0"
                                    }
                                    return intVal(a) + intVal(b);
                                },
                                0);
                    } else {
                        return 0;
                    }
                };
                var apply_footer = function (capacity, col) {
                    const selectedTotal = roundToTwo(totalize_selected(col));
                    let difference = capacity - selectedTotal;
                    let innerHtml;
                    if (difference < 0) {
                        innerHtml = '' + '<aui-badge style="background: #c51100; color: #ffffff;">' + selectedTotal + '</aui-badge>';
                    } else {
                        innerHtml = ' ' + (selectedTotal);
                    }
                    AJS.$(table.column(col).footer()).html(innerHtml);
                    AJS.$("#capacityTable tbody > tr:nth-child(3) > td:nth-child("+ (col-2) +")").text(roundToTwo(selectedTotal));

                    if (difference < 0) {
                        AJS.$("#capacityTable tbody > tr:nth-child(4) > td:nth-child("+ (col-2) +")").html('<aui-badge style="background: #c51000; color: #ffffff;">' +roundToTwo(difference)+ '</aui-badge>');
                    } else {
                        AJS.$("#capacityTable tbody > tr:nth-child(4) > td:nth-child("+ (col-2) +")").text(roundToTwo(difference));
                    }
                };

                table.columns('th[class*="program"]').indexes().each(function (e) {
                    apply_footer(table.column(e).header().getAttribute('remainingTime'), e);
                });
            };

            function roundToTwo(num) {
                return +(Math.round(num + "e+2")  + "e-2");
            }

            table.on( 'select', function ( e, dt, type, indexes ) {
                var table=AJS.$("#projectsTable").DataTable();
                table.search('');
                if ( type === 'row' ) {
                    for (var i = 0; i < indexes.length; i++) {
                        table.cell(indexes[i],0).data("YYYY").draw();
                    }
                }
                // displayFooter();
                // Her select'te çalışıo performans sıkıntısı olabilir.
                var valuesSet = table
                        .column(getColumnIndex("customfield_11405")) //Departman
                        .data()
                        .unique();

                createTable1(valuesSet,"customfield_11405");

            } );

            table.on( 'deselect', function ( e, dt, type, indexes ) {
                //console.log("denug");
                var table=AJS.$("#projectsTable").DataTable();

                table.search( '' );
                if ( type === 'row' ) {
                    for (var i = 0; i < indexes.length; i++) {
                        table.cell(indexes[i],0).data("--").draw();
                    }
                    //table.rows( indexes ).cell(':eq(0)').data("--").draw();
                    // console.log("Sildim" +table.rows( indexes ).cell(':eq(0)').data());
                }

                var valuesSet = table
                        .column(getColumnIndex("customfield_11405")) //Departman
                        .data()
                        .unique();

                createTable1(valuesSet,"customfield_11405");

               // displayFooter();
            } );

            AJS.$("#select2").select2();
            AJS.$("#customFieldList-select2").auiSelect2();
            AJS.$("#projeEtiketleri-select2").auiSelect2({
                placeholder: "Proje Etiketleri"
            });

            #foreach($cfw in $CfFilters)
                #set ($customField=$cfw.getCustomField())
                AJS.$("#$customField.getId()-select2").auiSelect2({
                    placeholder: "$customField.getName()"
                });

                AJS.$("#$customField.getId()-select2").on('select2-selecting', function (e) {
                    table.columns('th:contains("$customField.getName()")').search( e.val ).draw();
                });

                AJS.$("#$customField.getId()-clear").click(function(e) {
                    e.preventDefault();
                    table.search('')
                            .columns().search('');

                    AJS.$("#$customField.getId()-select2").select2("val", "").trigger('change');
                    #foreach($cfw in $CfFilters)
                        #set ($customField=$cfw.getCustomField())
                        table.columns('th:contains("$customField.getName()")').search( AJS.$("#$customField.getId()-select2").val());
                    #end
                    table.draw();
                });
            #end

            //AJS.$("#customFieldList-select2").find('option').prop('selected', 'selected');
            var toggle = AJS.$("#onlyShowSelectedOnes");
            toggle.checked = false;
            toggle.click(function(e) {
                var isChecked = toggle.checked;
                if (isChecked === false) {
                    toggle.checked = true;
                    table.search( '' )
                            .columns('th:contains("isSelected")').search( 'YYYY' )
                            .draw();
                }else {
                    toggle.checked = false;
                    table.search( '' ).columns().search( '' );
                    #foreach($cfw in $CfFilters)
                        #set ($customField=$cfw.getCustomField())
                        table.columns('th:contains("$customField.getName()")').search( AJS.$("#$customField.getId()-select2").val());
                    #end
                    table.draw();
                }
            });

            AJS.$("#select-all").click(function(e) {
                table.rows( {order:'index', search:'applied'} ).select();
            });

            AJS.$("#deselect-all").click(function(e) {
                table.rows( {order:'index', search:'applied'} ).deselect();
            });

            AJS.$("#customFieldList-select2").on('select2-selecting', function (e) {
                // Header'ı göster
                // AJS.$('#projectsTable > thead  th[data-override*="'+e.val+'"]').show();
                // updateCustomFieldTableDatas(e.val);
                // displayFooter();
                // hideTableRowsAccordingToOncelikSlider(1);
                // Get the column API object
                var column = table.column( 'th[customfieldid="'+e.val+'"]') ;
                // Toggle the visibility
                //column.visible(false);
                column.visible( ! column.visible() );
            });

            AJS.$("#customFieldList-select2").on("select2-removing", function(e) {
                // AJS.$('#projectsTable > thead  th[data-override*="'+e.val+'"]').hide();
                // AJS.$('#projectsTable > tbody  tr td[class*="'+e.val+'"]').hide();
                // // hideTableRowsAccordingToOncelikSlider(1);

                // Get the column API object
                var column = table.column( 'th[customfieldid="'+e.val+'"]') ;
                // Toggle the visibility
                //column.visible( true  );
                column.visible( ! column.visible() );

            });

            // AJS.$( "#customFieldList-select2 > option").each(function(index) {
            //     // AJS.$(this).prop("selected" , true);
            //     // AJS.$("#customFieldList-select2").trigger("change");
            //
            // });

            // AJS.$("#projeEtiketleri-select2").on('select2-removing', function (e) {
            //
            //     // table.search( '' )
            //     //         .columns().search( '' )
            //     //         .draw();
            // });

            //AJS.$("#customFieldList-select2").trigger("select2:select");

            // function onpageSwitch(){
            //     var dinamikEklenenlerTableHeaderlar = AJS.$('#projectsTable > thead  th[class*="dinamikEklenenler"]:not([style*=none])');
            //     dinamikEklenenlerTableHeaderlar.each(function () {
            //         var cfId=AJS.$(this).attr("data-override");
            //         updateCustomFieldTableDatas(cfId);
            //     });
            //     // hideTableRowsAccordingToOncelikSlider(1);
            // }

            // function updateCustomFieldTableDatas(cfId){
            //     //custom Field td'leri çeker bu
            //     var issueCFsectionInTable = AJS.$('#projectsTable > tbody  tr td[class*="'+cfId+'"]');
            //     var issueKeys =[];
            //     issueCFsectionInTable.each(function () {
            //         //td'ın parent'ı tr'a gidio sonra tr'ın ilk sütunu yani issue key sütünunu çekio
            //         var issueKey=AJS.$(this).parent().children().first().children().first().prop("innerHTML");
            //         issueKeys.push(issueKey);
            //         AJS.$(this).show();
            //     });
            //
            //     var cfValues=bulkGetCfValuesFromIssue(issueKeys.join(","),cfId);
            //     //Burada kritik nokta cfValues length ile Table'daki row sayısı mutlaka aynı olmalı !!!
            //     var array=cfValues.split(",,,");
            //     for(var i = 0; i < array.length; i++) {
            //         issueCFsectionInTable[i].innerHTML=array[i];
            //         AJS.$(issueCFsectionInTable[i]).show();
            //     }
            // }

            // function bulkGetCfValuesFromIssue(issueKeys, customfieldId){
            //     var value="-";
            //     jQuery.ajax({
            //         url: AJS.params.baseURL + "/rest/florestservice/1.2/rest/bulkGetCfValueFromIssue",
            //         type: 'POST',
            //         data: {
            //             issueKey: issueKeys,
            //             customFieldId: customfieldId
            //         },
            //         async: false,
            //         beforeSend: function () {
            //             console.log("getCfValueFromIssue function started!");
            //         },
            //         error : function (response) {
            //             value= "-";
            //             console.log("getCfValueFromIssue ERROR!!!");
            //         },
            //         success: function (response, status, jqXHR) {
            //             console.log("getCfValueFromIssue complete");
            //             value=response;
            //             var i;
            //             for (i = 0; i < 5; i++) {
            //                 window.scrollTo({
            //                     left: 9999999,
            //                     behavior: 'smooth'
            //                 });
            //             }
            //         }
            //     });
            //     return value;
            // }

            /*            AJS.$("#customFieldList-select2").select2({
                            maximumSelectionLength: 6
                        });*/

            /*
                        AJS.$("#customFieldList-select2").on('select2:select', function (e) {
                                AJS.$('#projectsTable>tbody').find('tr').each(function(){
                                    var trow = AJS.$(this);
                                    var issueKey=trow.context.cells[0].innerText;

                                    jQuery.ajax({
                                        url: AJS.params.baseURL + "/rest/florestservice/1.2/rest/getCfValueFromIssue",
                                        type: 'GET',
                                        data: {
                                            issueKey: trow.context.cells[0].innerText,
                                            customFieldId: "customfield_10814"
                                        },
                                        async: false,
                                        beforeSend: function () {
                                        },
                                        complete: function (response) {
                                        },
                                        success: function (response, status, jqXHR) {
                                            trow.find('td').eq(1).after('<td> asd '+response.toString()+'</td>');
                                            console.log(response.toString());
                                        }
                                    });
                                });
                        });
            */

            // AJS.$('#select2').live('change', function () {
            //     window.location.replace("https://jira.veniture.tk/plugins/servlet/projectapprove?action=" + this.value);
            //
            //     //  AJS.$('#select2').val(this.value); // Change the value or make some change to the internal state
            //     //  AJS.$('#select2').trigger('change.select2'); // Notify only Select2 of changes
            // });

            // AJS.$('#oncelik-range').jRange({
            //     from: 1,
            //     to: 10,
            //     step: 1,
            //     scale: [0,5,10],
            //     format: '%s',
            //     width: 300,
            //     showLabels: true,
            //     isRange : true
            // });

            // var handle = AJS.$( "#custom-handle" );
            // AJS.$( "#slider" ).slider({
            //     max: 50,
            //     create: function() {
            //         handle.text( $( this ).slider( "value" ) );
            //     },
            //     slide: function( event, ui ) {
            //         handle.text( ui.value );
            //     }
            // });

            AJS.$( "#slider-range" ).slider({
                range: true,
                min: 1,
                max: 100,
                step: 1,
                values: [ 1, 200 ],
                slide: function( event, ui ) {
                    AJS.$( "#amount" ).val( ui.values[ 0 ] + "-" +  ui.values[ 1 ] );
                }
            });

            AJS.$( "#amount" ).val( "" + AJS.$( "#slider-range" ).slider( "values", 0 ) +
                    "-" + AJS.$( "#slider-range" ).slider( "values", 1 ) );

            AJS.$( "#slider-range" ).on( "slidechange", function( event, ui ) {
                var values = AJS.$( "#slider-range" ).slider( "option", "values" );
                // hideTableRowsAccordingToOncelikSlider(1);
            } );
            window.onbeforeunload = null;

            function hideTableRowsAccordingToOncelikSlider(cfId){
                try {
                    showHiddenTableRows();
                    //custom Field td'leri çeker bu
                    var issueCFsectionInTable = AJS.$('#projectsTable > tbody  tr td[class*="customfield_11403"]');
                    issueCFsectionInTable.each(function () {
                        //td'ın parent'ı tr'a gidio sonra tr'ın ilk sütunu yani issue key sütünunu çekio
                        var tableRow=AJS.$(this).parent();
                        var number=AJS.$(this).prop("innerHTML");
                        var integer = parseInt(number, 10);
                        var lowerBound = parseInt(AJS.$( "#slider-range" ).slider( "values", 0 ), 10);
                        var upperBound = parseInt(AJS.$( "#slider-range" ).slider( "values", 1 ), 10);

                        if(integer<= lowerBound|| integer>=upperBound){
                            tableRow.hide();
                        }
                    });
                }
                catch(error) {
                    console.error(error);
                    // expected output: ReferenceError: nonExistentFunction is not defined
                    // Note - error messages will vary depending on browser
                }
            }

            function showHiddenTableRows(){
                AJS.$('#projectsTable > tbody tr:hidden').show();
            }

            AJS.$('#ApproveButton').off().on("click", function () {

                // var URL = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '');
                var selectedCellsArray = table.cells('.selected', 0).data().toArray();

                jQuery.ajax({
                    url: AJS.params.baseURL + "/rest/florestservice/1.2/rest/transitionissues",
                    type: 'GET',
                    data: {
                        issues: selectedCellsArray,
                        action: "approve"
                    },
                    async: true,
                    beforeSend: function () {
                        Swal.showLoading()
                    },
                    complete: function (response) {
                        Swal.hideLoading()
                    },
                    error: function (response) {
                        Swal.fire({
                            type: 'error',
                            title: 'Oops...',
                            text: 'Something went wrong!',
                            footer: '<a href="mailto:berk.karabacak@veniture.com.tr ?Subject=Error%20at%20ProjectApprove" target="_top">Send Mail</a>'
                        })
                    },
                    success: function (response, status, jqXHR) {
                        Swal.fire(
                                'Başarılı!',
                                'Projeler Onaylandı!',
                                'success'
                        )
                    }
                });
            })

            AJS.$('#DeclineButton').off().on("click", function () {

                // var URL = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '');

                var selectedCellsArray = table.cells('.selected', 0).data().toArray();

                jQuery.ajax({
                    url: AJS.params.baseURL + "/rest/florestservice/1.2/rest/transitionissues",
                    type: 'GET',
                    data: {
                        issues: selectedCellsArray,
                        action: "decline"
                    },
                    async: true,
                    beforeSend: function () {
                        Swal.showLoading()
                    },
                    complete: function (response) {
                        Swal.hideLoading()
                    },
                    error: function (response) {
                        Swal.fire({
                            type: 'error',
                            title: 'Oops...',
                            text: 'Something went wrong!',
                            footer: '<a href="mailto:berk.karabacak@veniture.com.tr ?Subject=Error%20at%20ProjectApprove" target="_top">Send Mail</a>'
                        })
                    },
                    success: function (response, status, jqXHR) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Reddedildi',
                            text: 'Projeler reddedildi!'})
                    }
                });
            });

            loadData();
            function loadData() {
                jQuery.ajax({
                    type: 'POST',
                    url: AJS.params.baseURL + "/rest/florestservice/1.2/rest/getProjectIssues",
                    contentType: "text/plain",
                    dataType: 'json',
                    success: function (data) {
                        myJsonData = data;
                        populateDataTable(myJsonData);
                        let valuesSet = table.column(getColumnIndex("customfield_11405")) //Departman
                                .data()
                                .unique();
                        createTable1(valuesSet,"customfield_11405");
                    },
                    error: function (e) {
                        console.log("There was an error with your request...");
                        console.log("error: " + JSON.stringify(e));
                    }
                });
            }

            // populate the data table with JSON data
            function populateDataTable(data) {
                console.log("populating data table...");

                // var length = Object.keys(data).length;

                //Object.values(data)[0] {issue: "PF-2971", summary: "Satış Kaybı (Yeni)", customfield_11802: "", customfield_11803: "1234.0", customfield_11805: "2314.0", …}issue: "PF-2971"summary: "Satış Kaybı (Yeni)"customfield_11802: ""customfield_11803: "1234.0"customfield_11805: "2314.0"customfield_11804: "23.0"customfield_11806: "4.0"__proto__: Object

                //var keyValue=Object.values(data)[0];

                var table = AJS.$("#projectsTable").DataTable();

                // clear the table before populating it with more data
                //tableTest.clear();

                // for (var key in asd) {
                //     console.log(key);
                // }

                Object.keys(data).forEach(function(key){

                    // STATIC VARIABLE
                    var IssueKeyColumnIndex = 2;
                    var issueKey = Object.values(data[key])[IssueKeyColumnIndex];
                    data[key]["issue"]='<a href="$baseUrl/browse/'+ issueKey+'" target="_blank">'+issueKey+'</a>';
                    //console.log(Object.values(data[key])[0]);
                    table.row.add(Object.values(data[key])).draw( false );
                });

                //tableTest.find('td').addClass('might-overflow');

                // for(var i = 1; i < length+1; i++) {
                //     var customer = data.customers['customer'+i];
                //
                //     tableTest.row.add( [
                //         customer.first_name,
                //         customer.last_name,
                //         customer.occupation,
                //         customer.email_address
                //     ] ).draw( false );
                // }
                Swal.hideLoading();
                Swal.close();
            }

            function getColumnIndex(customfieldIdAsString){
                //return table.columns('th:contains("'+headerName+ '")').indexes()[0]
                var table = AJS.$("#projectsTable").DataTable();
                return table.column('th[customFieldId="'+customfieldIdAsString + '"]').index()
            }

            var table = AJS.$("#projectsTable").DataTable();
            //var columnIndex= getColumnIndex(customfieldIdAsString)

            var myPieChart ;
            function createTable1(valuesSet,customfieldIdAsString) {

                var data = {
                    labels: [],
                    datasets: [
                        {
                            data: []
                        }
                    ]
                };

                var i;
                if(myPieChart!=null){
                    myPieChart.destroy();
                }

                for(i = 0; i < valuesSet.length; i++){
                    //var count=table.columns('th:contains("Sponsor")').search( va[i] ).draw().rows( {order:'index', search:'applied'} ).count();
                    //var valueCount=table.columns('th[customFieldId="'+customfieldIdAsString + '"]').search(valuesSet[i]).page.info().recordsDisplay;
                    var values=table.cells('.selected' , 'th[customFieldId="'+ customfieldIdAsString + '"]').data();

                    if (values.length==0) {
                        values=table.cells('' , 'th[customFieldId="'+ customfieldIdAsString + '"]').data();
                    }

                    var x;
                    var valueCount=0;
                    for (x = 0; x < values.length; x++) {
                        if (values[x]==valuesSet[i]){
                            valueCount++;
                        }
                    }

                    //console.log("Total count = " + valuesSet[i] + " = " + valueCount);
                    data.labels.push(valuesSet[i]);
                    data.datasets[0].data.push(valueCount);

                    // table.search('')
                    //         .columns().search( '' )
                    //         .draw()
                }

                var ctx = AJS.$("#chart1");

                myPieChart = new Chart(ctx, {
                    type: 'pie',
                    plugins: {
                        colorschemes: {
                            scheme: 'brewer.Paired12'
                        }
                    },
                    data: data,
                    options: {
                        title: {
                            display: true,
                            text: 'Departman'
                        }
                    }
                });

                // myPieChart.data.datasets.pop();
                // myPieChart.data.datasets.push(data);

                //var indexToUpdate = Math.round(Math.random() * data.labels.length);

                // Update one of the points in the second dataset
                //myPieChart.data.datasets[0].data[1] = Math.random() * 100;

                myPieChart.update();
            }
        });

        // table.columns('th:contains("Sponsor")').search( "Volkan Sezgin" ).draw().rows( {order:'index', search:'applied'} ).count()
    </script>

    <meta name="decorator" content="atl.general">
</head>

<body id="jira">
    <div class="content-container">
        <div class="content-body">
##            <button id="buildChart">create chart</button>

            <div class="aui-group">
                <header class="aui-page-header">
                    <div class="aui-page-header-inner">
                        <div class="aui-page-header-image">
                                <span class="aui-avatar aui-avatar-large aui-avatar-project">
                                    <span class="aui-avatar-inner">
                                        <img alt="FLO project" src="https://www.flo.com.tr/pub/assets/flo/img/logo.svg">
                                    </span>
                                </span>
                        </div>
                        <div class="aui-page-header-main">
                            <div class="aui-help aui-help-empty-state">
                                <div class="aui-help-content">
                                    <h1>Proje Onaylama</h1>
##                                    <p>Projeleri seçiniz ve onayla butonuna basınız. Birden fazla proje seçmek için CTRL tuşuna basılı tutun.</p>
##                                    <p>Kalan takım kapasiteleri tablonun altındadır ve her seçimle kalan kapasite güncellenir.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
            </div>

        ##    <div class="aui-group">
        ##        <div class="aui-item" id="jqlFilter">
        ##            <form class="aui">
        ##                <select id="select2" data-placeholder="Select a filter" style="width: 60%">
        ##                    <option></option>
        ##                    <option value="PLANLAMA">PLANLAMA</option>
        ##                    <option value="SATISARTTIRAN">SATISARTTIRAN</option>
        ##                    <option value="WFA">WFA</option>
        ##                </select>
        ##            </form>
        ##        </div>
        ##    </div>

        ##                <div class="aui-group">
        ##                    <div class="aui-item" id="customFieldList">
        ##                        <form class="aui">
        ##                            <select id="customFieldList-select2" data-placeholder="Select Fields" multiple style="width: 40%">
        ##                                <option></option>
        ##                                #foreach($cf in $projectCFs)
        ##                                    <option value="$cf.getId()">$cf.getFieldName()</option>
        ##                                #end
        ##                            </select>
        ##                        </form>
        ##                    </div>
        ##                </div>
##            <i id="loadingDiv" class="m-spinner--signal"></i>

            <div class="aui-group">
                <div class="aui-item" id="#select2-customFields">
                    <form class="aui">
                        <select id="customFieldList-select2" data-placeholder="Alanları eklemek için tıklayın." multiple style="padding-top: 18px; width: 93%">
                            <option></option>
                            #foreach($cf in $customFieldsInProject)
                                <option value="$cf.getId()">$cf.getFieldName()</option>
                            #end
                        </select>
                    </form>
                </div>
##                <div class="aui-item" id="#projeEtiketleri">
##                    <form class="aui">
##                        <select id="projeEtiketleri-select2" style="padding-top: 18px; width: 93%">
##                            <option></option>
##                            #foreach($option in $options)
##                                <option value="$option.getValue()">$option.getValue()</option>
##                            #end
##                        </select>
##                    </form>
##                    <span id="cfFilterClear" style="float: right; right: 17%; bottom: 24px;" class="aui-icon aui-icon-small aui-iconfont-cross-circle">Clear</span>
##                </div>
                #foreach($cfw in $CfFilters)
                    #set ($customField=$cfw.getCustomField())
                    #set ($options=$cfw.getOptions())
                    <div class="aui-item" id="#$customField.getId()">
                        <form class="aui">
                            <select id="$customField.getId()-select2" style="padding-top: 18px; width: 93%">
                                <option></option>
                                #foreach($option in $options)
                                    #if($option.getValue()!="-")
                                        <option value="$option.getValue()">$option.getValue()</option>
                                    #end
                                #end
                            </select>
                        </form>
                        <span id="$customField.getId()-clear" style="float: right; right: 17%; bottom: 24px;" class="aui-icon aui-icon-small aui-iconfont-cross-circle">Clear</span>
                    </div>
                #end

##                <div class="aui-item" id="#departmanlar">
##                    <form class="aui">
##                        <select id="departmanlar-select2" style="padding-top: 18px; width: 93%">
##                            <option></option>
##                            #foreach($option in $options)
##                                <option value="$option.getValue()">$option.getValue()</option>
##                            #end
##                        </select>
##                    </form>
##                    <span id="cfFilterClear" style="float: right; right: 17%; bottom: 24px;" class="aui-icon aui-icon-small aui-iconfont-cross-circle">Clear</span>
##                </div>
##                <div class="aui-item" id="#oncelikler-aui-item">
##                    <p>
##                        <label for="amount">WIP: Öncelik Aralığı:</label>
##                        <input type="text" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;">
##                    </p>
##                    <div id="slider-range"></div>
##                </div>
            </div>

            <div class="aui-group">
                <button class="aui-button" id="select-all">Tümünü seç</button>
                <button class="aui-button aui-button-primary" id="deselect-all">Tümünü kaldır</button>
            </div>

            <div class="aui-group">
                <div class="aui-item">
                    <table id="projectsTable" class="display" cellspacing="0" width="100%" style="width: 100%;border: 2px solid #bfb7b7!important;border-radius: 12px;">
                        <thead>
                            <tr>
                                <th>isSelected</th>
                                <th></th>
                                <th>Issue</th>
                                <th>Summary</th>
                                <th class="program" remainingTime="$ProjeYonetimiRemaining">Proje Yönetimi</th>
                                <th class="program" remainingTime="$SAPAbapRemaining">SAP Abap</th>
                                <th class="program" remainingTime="$YazilimGelistirmeRemaining">Yazılım Geliştirme</th>
                                <th class="program" remainingTime="$SAPUygulamaRemaining">SAP Uygulama</th>
                                <th class="program" remainingTime="$IsZekasiveRaporlamaRemaining">İş Zekası ve Raporlama</th>
                                <th class="program" remainingTime="$totalCapacityOfAllPrograms">Efor</th>
                                <th customFieldId="customfield_11403">Departman Önceliği</th>
                                <th customFieldId="customfield_11501">GMY Önceliği</th>
                                <th customFieldId="customfield_11405">Departman</th>
                                <th customFieldId="customfield_11304">Sponsor</th>
                                <th customFieldId="customfield_11302">Bir projenin yeni bir fazı ise belirtiniz</th>
                                <th customFieldId="customfield_11305">Etkilenecek Departmanlar</th>
                                <th customFieldId="customfield_11306">Proje Etiketleri</th>
                                <th customFieldId="customfield_11307">Satışa pozitif etkisini nasıl tarif edersiniz?</th>
                                <th customFieldId="customfield_11308">Satışa pozitif etkisi baremleri (Yıllık / TL)</th>
                                <th customFieldId="customfield_11309">Maliyeti azaltmasını nasıl tarif edersiniz?</th>
                                <th customFieldId="customfield_11310">Maliyet tasarrufu baremleri (Yıllık / TL)</th>
                                <th customFieldId="customfield_11311">Verimliliğe etkisini nasıl tarif edersiniz?</th>
                                <th customFieldId="customfield_11312">Verimlilik etkisi baremleri (Yıllık / Adet)</th>
                                <th customFieldId="customfield_11313">Şu anda bu süreçler manuel yürütülebiliyor mu?</th>
                                <th customFieldId="customfield_11314">Manuel Yürütmedeki Zorluklar</th>
                                <th customFieldId="customfield_11315">Danışmanlık Gerekli mi?</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th>isSelected</th>
                                <th></th>
                                <th>Issue</th>
                                <th>Summary</th>
                                <th class="program">Proje Yönetimi</th>
                                <th class="program">SAP Abap</th>
                                <th class="program">Yazılım Geliştirme</th>
                                <th class="program">SAP Uygulama</th>
                                <th class="program">İş Zekası ve Raporlama</th>
                                <th class="program" remainingTime="$TotalRemainingCapacity">$TotalRemainingCapacity</th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                            </tr>
                        </tfoot>
                    </table>
                    <div id="bottom-button-div">
                        <div style="float: left">
                            <button class="aui-button aui-button-primary" id="ApproveButton">Projeleri Onayla</button>
                            <button class="aui-button" id="DeclineButton">Projeleri Reddet</button>
                        </div>
                        <div style="float: right">
                            <aui-label for="onlyShowSelectedOnes" resolved="">
                                <label for="onlyShowSelectedOnes">Seçilenleri Göster</label>
                            </aui-label>
                            <aui-toggle id="onlyShowSelectedOnes" label="Sepeti Göster"></aui-toggle>
                        </div>
                    </div>
                </div>
            </div>

            <table id="capacityTable" class="aui">
                <thead>
                    <tr>
                        <th id="basic-number"   ></th>
                        <th id="basic-fname"    >Proje Yönetimi</th>
                        <th id="basic-lname"    >SAP Abap</th>
                        <th id="basic-username" >Yazılım Geliştirme</th>
                        <th id="basic-username" >SAP Uygulama</th>
                        <th id="basic-username" >İş Zekası ve Raporlama</th>
                        <th id="basic-username" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td headers="basic-number">Toplam çalışan</td>
                        <td headers="basic-lname">$ProjeYonetimiTotal</td>
                        <td headers="basic-lname">$SAPAbapTotal</td>
                        <td headers="basic-lname">$YazilimGelistirmeTotal</td>
                        <td headers="basic-lname">$SAPUygulamaTotal</td>
                        <td headers="basic-lname">$IsZekasiveRaporlamaTotal</td>
                        <td headers="basic-lname">$totalCapacityOfAllPrograms</td>
                    </tr>
                    <tr>
                        <td headers="basic-fname">Müsait çalışan sayısı</td>
                        <td headers="basic-lname">$ProjeYonetimiRemaining</td>
                        <td headers="basic-lname">$SAPAbapRemaining</td>
                        <td headers="basic-lname">$YazilimGelistirmeRemaining</td>
                        <td headers="basic-lname">$SAPUygulamaRemaining</td>
                        <td headers="basic-lname">$IsZekasiveRaporlamaRemaining</td>
                        <td headers="basic-lname">$TotalRemainingCapacity</td>
                    </tr>
                    <tr>
                        <td headers="basic-lname">Seçilenler için gerekli çalışab sayısı</td>
                        <td headers="basic-lname">$ProjeYonetimiRemaining</td>
                        <td headers="basic-lname">$SAPAbapRemaining</td>
                        <td headers="basic-lname">$YazilimGelistirmeRemaining</td>
                        <td headers="basic-lname">$SAPUygulamaRemaining</td>
                        <td headers="basic-lname">$IsZekasiveRaporlamaRemaining</td>
                        <td headers="basic-lname">$TotalRemainingCapacity</td>
                    </tr>
                    <tr>
                        <td headers="basic-fname">Fark</td>
                        <td headers="basic-lname">0</td>
                        <td headers="basic-lname">0</td>
                        <td headers="basic-lname">0</td>
                        <td headers="basic-lname">0</td>
                        <td headers="basic-lname">0</td>
                        <td headers="basic-lname">0</td>
                    </tr>
                </tbody>
            </table>

            <div class="aui-group">
                <div class="aui-item">
                    <canvas id="chart1" width="400" height="400"></canvas>
                </div>
                <div class="aui-item">
                    <canvas id="chart2" width="400" height="400"></canvas>
                </div>
                <div class="aui-item">
                    <canvas id="chart3" width="400" height="400"></canvas>
                </div>
            </div>

##            <div class="aui-group">
##                <div class="aui-item" id="issueTableDiv">
##                    <table id="projectsTable" class="display nowrap" width="100%">
##                        <thead>
##                        <tr>
##                            <th style="text-align: left;">Key</th>
##                            <th style="text-align: left;">Summary</th>
##                        ##                    #foreach($program in $programs) #end
##                            <th class="program" style="text-align: center;" remainingTime="$ProjeYonetimi">Proje Yönetimi</th>
##                            <th class="program" style="text-align: center;" remainingTime="$SAPAbap">SAP Abap</th>
##                            <th class="program" style="text-align: center;" remainingTime="$YazilimGelistirme">Yazılım Geliştirme</th>
##                            <th class="program" style="text-align: center;" remainingTime="$SAPUygulama">SAP Uygulama</th>
##                            <th class="program" style="text-align: center;" remainingTime="$IsZekasiveRaporlama">İş Zekası ve Raporlama</th>
##
##                            #foreach($cf in $customFieldsInProject)
##                                <th style="display:none; text-align: left;" class="dinamikEklenenler" data-override="$cf.getId()">$cf.getName()</th>
##                            #end
##                        </tr>
##                        </thead>
##                        <tfoot>
##                        <tr>
##                            <th></th>
##                            <th>Kalan</th>
##                        ##                    #foreach($program in $programs)
##                        ##                        <th class="program" style="text-align: center;">$program.getCapacity()</th>
##                        ##                    #end
##                            <th class="program" style="text-align: center;">#if($ProjeYonetimi) $ProjeYonetimi #else 0 #end
##                            </th>
##                            <th class="program" style="text-align: center;">#if($SAPAbap) $SAPAbap #else 0 #end
##                            </th>
##                            <th class="program" style="text-align: center;">#if($YazilimGelistirme) $YazilimGelistirme #else 0 #end
##                            </th>
##                            <th class="program" style="text-align: center;">#if($SAPUygulama) $SAPUygulama #else 0 #end
##                            </th>
##                            <th class="program" style="text-align: center;">#if($IsZekasiveRaporlama) $IsZekasiveRaporlama #else 0 #end
##                            </th>
##                            #foreach($cf in $customFieldsInProject)
##                                <th style="display:none; text-align: left;" class="dinamikEklenenler" data-override="$cf.getId()">$cf.getName()</th>
##                            #end
##                        </tr>
##                        </tfoot>
##                        <tbody>
##                            #foreach( $IssueWithCF in $issuesWithCF )
##                            <tr>
##                                #set ($issue=$IssueWithCF.getIssue())
##                            ##                      Burada bişi değiştirirken dikkat et, buralara referans atan updateCF fonksiyonu var
##                                <td><a href="$baseUrl/browse/$issue.getKey()">$issue.getKey()</a></td>
##                                <td>$issue.getSummary()</td>
##                                #foreach($eforCf in $eforCfs)
##                                    <td class="eforCf" style="text-align: center;">
##                                        #if($eforCf.getValue($issue)) $eforCf.getValue($issue).intValue() #else 0 #end
##                                    </td>
##                                #end
##                                #foreach($cf in $customFieldsInProject)
##                                    <td style="display:none; text-align: left;" class="might-overflow $cf.getId()">-</td>
##                                #end
##                            </tr>
##                            #end
##                        </tbody>
##                    </table>
##                    <button class="aui-button aui-button-primary" id="ApproveButton">Projeleri Onayla</button>
##                    <button class="aui-button" id="DeclineButton">Projeleri Reddet</button>
##                </div>
##            </div>
        </div>
    </div>
</body>
</html>